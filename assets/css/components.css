/* ============================================================
   COMPONENTS.CSS  —  Namak Messenger
   Chat bubbles media, emoji panel, voice recorder,
   profile, settings, contacts, modals, media viewer,
   call overlay, stories, skeleton loaders
   ============================================================ */

/* ──────────────────────────────────────────────────────────
   1. MEDIA MESSAGES
────────────────────────────────────────────────────────── */
.msg-media {
    position:       relative;
    border-radius:  var(--radius-lg);
    overflow:       hidden;
    cursor:         pointer;
    max-width:      280px;
    background:     var(--bg-surface-3);
}
.msg-media img,
.msg-media video {
    display:        block;
    width:          100%;
    max-height:     320px;
    object-fit:     cover;
}
.msg-media--loading { min-height: 160px; }
.msg-media__overlay {
    position:       absolute;
    inset:          0;
    background:     rgba(0,0,0,.35);
    display:        flex;
    align-items:    center;
    justify-content:center;
}
.msg-media__play {
    width:          52px;
    height:         52px;
    background:     rgba(255,255,255,.9);
    border-radius:  50%;
    display:        flex;
    align-items:    center;
    justify-content:center;
    font-size:      22px;
    padding-inline-start: 3px;
    transition:     transform var(--transition-spring);
}
.msg-media:hover .msg-media__play { transform: scale(1.08); }

.msg-media__duration {
    position:       absolute;
    bottom:         var(--sp-2);
    inset-inline-end: var(--sp-2);
    background:     rgba(0,0,0,.55);
    color:          #fff;
    font-size:      var(--font-size-xs);
    padding:        2px 7px;
    border-radius:  var(--radius-full);
    backdrop-filter:var(--blur-sm);
}
.msg-media__progress {
    position:       absolute;
    bottom:         0;
    inset-inline-start: 0;
    height:         3px;
    background:     var(--brand);
    transition:     width .1s linear;
}
.msg-media__spoiler {
    position:       absolute;
    inset:          0;
    backdrop-filter:blur(20px);
    display:        flex;
    flex-direction: column;
    align-items:    center;
    justify-content:center;
    gap:            var(--sp-2);
    color:          #fff;
    font-size:      var(--font-size-sm);
    cursor:         pointer;
}

/* Document */
.msg-doc {
    display:        flex;
    align-items:    center;
    gap:            var(--sp-3);
    padding:        var(--sp-3);
    min-width:      220px;
    max-width:      320px;
}
.msg-doc__icon {
    width:          44px;
    height:         44px;
    border-radius:  var(--radius-md);
    background:     var(--brand-alpha-10);
    display:        flex;
    align-items:    center;
    justify-content:center;
    font-size:      22px;
    flex-shrink:    0;
}
.msg-doc__info  { flex: 1; min-width: 0; }
.msg-doc__name  {
    font-size:      var(--font-size-sm);
    font-weight:    var(--font-weight-semi);
    overflow:       hidden;
    text-overflow:  ellipsis;
    white-space:    nowrap;
}
.msg-doc__meta  { font-size: var(--font-size-xs); color: var(--text-tertiary); margin-top: 2px; }
.msg-doc__dl    {
    width:          34px;
    height:         34px;
    border-radius:  50%;
    background:     var(--brand);
    color:          #fff;
    display:        flex;
    align-items:    center;
    justify-content:center;
    flex-shrink:    0;
    transition:     transform var(--transition-spring);
}
.msg-doc__dl:hover  { transform: scale(1.08); }
.msg-doc__dl svg    { width: 16px; height: 16px; }

/* Audio / Voice */
.msg-audio {
    display:        flex;
    align-items:    center;
    gap:            var(--sp-3);
    padding:        var(--sp-2) var(--sp-3);
    min-width:      200px;
    max-width:      300px;
}
.msg-audio__btn {
    width:          38px;
    height:         38px;
    border-radius:  50%;
    background:     var(--brand);
    color:          #fff;
    display:        flex;
    align-items:    center;
    justify-content:center;
    flex-shrink:    0;
    transition:     transform var(--transition-spring), background var(--transition-fast);
}
.msg-audio__btn:hover   { background: var(--brand-dark); transform: scale(1.05); }
.msg-audio__btn svg     { width: 18px; height: 18px; }
.msg-audio__waveform {
    flex:           1;
    display:        flex;
    align-items:    center;
    gap:            2px;
    height:         32px;
    cursor:         pointer;
}
.msg-audio__bar {
    flex:           1;
    background:     var(--border-strong);
    border-radius:  2px;
    transition:     background var(--transition-fast);
}
.msg-audio__bar--played { background: var(--brand); }
.msg-audio__time {
    font-size:      var(--font-size-xs);
    color:          var(--text-tertiary);
    white-space:    nowrap;
    flex-shrink:    0;
    font-feature-settings: 'tnum';
}

/* Location */
.msg-location {
    border-radius:  var(--radius-lg);
    overflow:       hidden;
    cursor:         pointer;
    max-width:      280px;
}
.msg-location img       { width: 100%; height: 160px; object-fit: cover; display: block; }
.msg-location__label {
    padding:        var(--sp-2) var(--sp-3);
    font-size:      var(--font-size-xs);
    color:          var(--text-secondary);
    display:        flex;
    align-items:    center;
    gap:            var(--sp-1);
}

/* Contact card in message */
.msg-contact {
    display:        flex;
    align-items:    center;
    gap:            var(--sp-3);
    padding:        var(--sp-3);
    min-width:      220px;
}
.msg-contact__info  { flex: 1; min-width: 0; }
.msg-contact__name  { font-weight: var(--font-weight-semi); font-size: var(--font-size-sm); }
.msg-contact__phone { font-size: var(--font-size-xs); color: var(--text-tertiary); }
.msg-contact__add   {
    border-radius:  var(--radius-full);
    border:         1px solid var(--brand);
    color:          var(--brand);
    padding:        5px 14px;
    font-size:      var(--font-size-xs);
    font-weight:    var(--font-weight-semi);
    transition:     background var(--transition-fast), color var(--transition-fast);
}
.msg-contact__add:hover { background: var(--brand); color: #fff; }

/* Poll */
.msg-poll          { min-width: 240px; max-width: 320px; }
.msg-poll__question{ font-weight: var(--font-weight-semi); margin-bottom: var(--sp-3); }
.msg-poll__option {
    display:        flex;
    align-items:    center;
    gap:            var(--sp-2);
    padding:        var(--sp-2) 0;
    cursor:         pointer;
    position:       relative;
}
.msg-poll__bar-wrap {
    position:       absolute;
    inset:          0;
    border-radius:  var(--radius-sm);
    overflow:       hidden;
    pointer-events: none;
}
.msg-poll__bar {
    height:         100%;
    background:     var(--brand-alpha-10);
    transition:     width .4s ease;
}
.msg-poll__text     { flex: 1; font-size: var(--font-size-sm); position: relative; }
.msg-poll__pct      { font-size: var(--font-size-xs); color: var(--text-secondary); position: relative; }
.msg-poll__check    { width: 16px; height: 16px; color: var(--brand); position: relative; }
.msg-poll__total    { font-size: var(--font-size-xs); color: var(--text-tertiary); margin-top: var(--sp-2); }

/* Sticker */
.msg-sticker img {
    width:          140px;
    height:         140px;
    object-fit:     contain;
    background:     transparent;
}

/* Link preview */
.msg-link-preview {
    border-inline-start: 3px solid var(--brand);
    border-radius:  0 var(--radius-md) var(--radius-md) 0;
    overflow:       hidden;
    margin-top:     var(--sp-2);
    cursor:         pointer;
}
.msg-link-preview__img { width: 100%; max-height: 160px; object-fit: cover; }
.msg-link-preview__body{ padding: var(--sp-2) var(--sp-3); }
.msg-link-preview__site{ font-size: var(--font-size-xs); color: var(--brand); margin-bottom: 2px; }
.msg-link-preview__title{ font-size: var(--font-size-sm); font-weight: var(--font-weight-semi); }
.msg-link-preview__desc { font-size: var(--font-size-xs); color: var(--text-secondary); margin-top: 2px; }

/* ──────────────────────────────────────────────────────────
   2. EMOJI PANEL
────────────────────────────────────────────────────────── */
.emoji-panel {
    position:       absolute;
    bottom:         calc(100% + var(--sp-2));
    inset-inline-start: 0;
    width:          360px;
    max-width:      calc(100vw - var(--sp-4));
    background:     var(--bg-modal);
    border-radius:  var(--radius-2xl);
    box-shadow:     var(--shadow-xl);
    border:         1px solid var(--border);
    display:        flex;
    flex-direction: column;
    overflow:       hidden;
    z-index:        var(--z-dropdown);
    animation:      slideUp 200ms var(--transition-spring) forwards;
}
.emoji-panel__search {
    padding:        var(--sp-3);
    border-bottom:  1px solid var(--border);
    flex-shrink:    0;
}
.emoji-panel__search .input { border-radius: var(--radius-full); font-size: var(--font-size-sm); }
.emoji-panel__cats {
    display:        flex;
    padding:        0 var(--sp-2);
    border-bottom:  1px solid var(--border);
    overflow-x:     auto;
    scrollbar-width:none;
    flex-shrink:    0;
}
.emoji-panel__cats::-webkit-scrollbar { display: none; }
.emoji-cat-btn {
    padding:        var(--sp-2) var(--sp-3);
    font-size:      18px;
    border-radius:  var(--radius-md);
    flex-shrink:    0;
    transition:     background var(--transition-fast);
}
.emoji-cat-btn.active,
.emoji-cat-btn:hover { background: var(--bg-surface-2); }
.emoji-panel__body {
    flex:           1;
    overflow-y:     auto;
    padding:        var(--sp-2);
    max-height:     280px;
}
.emoji-section__title {
    font-size:      var(--font-size-xs);
    color:          var(--text-tertiary);
    font-weight:    var(--font-weight-semi);
    padding:        var(--sp-2) var(--sp-1);
    text-transform: uppercase;
    letter-spacing: .06em;
}
.emoji-grid {
    display:        grid;
    grid-template-columns: repeat(8, 1fr);
    gap:            2px;
}
.emoji-btn {
    width:          38px;
    height:         38px;
    font-size:      22px;
    border-radius:  var(--radius-md);
    display:        flex;
    align-items:    center;
    justify-content:center;
    transition:     background var(--transition-fast), transform var(--transition-fast);
    line-height:    1;
}
.emoji-btn:hover {
    background:     var(--bg-surface-2);
    transform:      scale(1.2);
}
.emoji-btn:active { transform: scale(.9); }
.no-animate-emoji .emoji-btn { transition: none; }
.emoji-panel__tabs {
    display:        flex;
    border-top:     1px solid var(--border);
    flex-shrink:    0;
}
.emoji-tab {
    flex:           1;
    padding:        var(--sp-2);
    font-size:      var(--font-size-sm);
    color:          var(--text-secondary);
    text-align:     center;
    transition:     color var(--transition-fast), background var(--transition-fast);
}
.emoji-tab.active { color: var(--brand); }
.emoji-tab:hover  { background: var(--bg-surface-2); }

/* GIF grid */
.gif-grid {
    display:        grid;
    grid-template-columns: repeat(2, 1fr);
    gap:            var(--sp-2);
}
.gif-item {
    border-radius:  var(--radius-md);
    overflow:       hidden;
    cursor:         pointer;
    aspect-ratio:   16/9;
    background:     var(--bg-surface-3);
    transition:     transform var(--transition-spring);
}
.gif-item:hover  { transform: scale(1.03); }
.gif-item img    { width: 100%; height: 100%; object-fit: cover; }

/* Sticker grid */
.sticker-grid {
    display:        grid;
    grid-template-columns: repeat(4, 1fr);
    gap:            var(--sp-2);
}
.sticker-item {
    aspect-ratio:   1;
    border-radius:  var(--radius-md);
    cursor:         pointer;
    padding:        var(--sp-2);
    transition:     background var(--transition-fast), transform var(--transition-spring);
}
.sticker-item:hover {
    background: var(--bg-surface-2);
    transform:  scale(1.08);
}
.sticker-item img { width: 100%; height: 100%; object-fit: contain; }

/* ──────────────────────────────────────────────────────────
   3. VOICE RECORDER UI
────────────────────────────────────────────────────────── */
.voice-recorder {
    display:        flex;
    align-items:    center;
    gap:            var(--sp-3);
    padding:        var(--sp-2) var(--sp-3);
    flex:           1;
    animation:      fadeIn var(--transition-base);
}
.voice-recorder__cancel {
    color:          var(--danger);
    font-size:      var(--font-size-sm);
    font-weight:    var(--font-weight-semi);
    flex-shrink:    0;
}
.voice-recorder__wave {
    flex:           1;
    display:        flex;
    align-items:    center;
    justify-content:center;
    gap:            3px;
    height:         32px;
}
.voice-recorder__wave-bar {
    width:          3px;
    background:     var(--danger);
    border-radius:  3px;
    animation:      voiceWave 600ms ease-in-out infinite alternate;
}
.voice-recorder__wave-bar:nth-child(2)  { animation-delay: 80ms; }
.voice-recorder__wave-bar:nth-child(3)  { animation-delay: 160ms; }
.voice-recorder__wave-bar:nth-child(4)  { animation-delay: 240ms; }
.voice-recorder__wave-bar:nth-child(5)  { animation-delay: 160ms; }
.voice-recorder__wave-bar:nth-child(6)  { animation-delay: 80ms; }
.voice-recorder__timer {
    font-size:      var(--font-size-sm);
    font-weight:    var(--font-weight-semi);
    color:          var(--danger);
    font-feature-settings: 'tnum';
    flex-shrink:    0;
}
.voice-recorder__dot {
    width:          8px;
    height:         8px;
    background:     var(--danger);
    border-radius:  50%;
    flex-shrink:    0;
    animation:      blink 1.2s ease-in-out infinite;
}

/* ──────────────────────────────────────────────────────────
   4. ATTACHMENT MENU
────────────────────────────────────────────────────────── */
.attach-menu {
    position:       absolute;
    bottom:         calc(100% + var(--sp-2));
    inset-inline-start: 0;
    display:        flex;
    flex-direction: column;
    gap:            var(--sp-2);
    z-index:        var(--z-dropdown);
    animation:      slideUp 200ms var(--transition-spring) forwards;
}
.attach-btn {
    display:        flex;
    align-items:    center;
    gap:            var(--sp-3);
    padding:        10px var(--sp-4);
    background:     var(--bg-modal);
    border-radius:  var(--radius-lg);
    box-shadow:     var(--shadow-md);
    font-size:      var(--font-size-sm);
    font-weight:    var(--font-weight-medium);
    white-space:    nowrap;
    transition:     background var(--transition-fast), transform var(--transition-spring);
}
.attach-btn:hover   { background: var(--bg-surface-2); transform: translateX(4px); }
.attach-btn__icon {
    width:          36px;
    height:         36px;
    border-radius:  50%;
    display:        flex;
    align-items:    center;
    justify-content:center;
    font-size:      18px;
    flex-shrink:    0;
}

/* ──────────────────────────────────────────────────────────
   5. PROFILE PANEL CONTENT
────────────────────────────────────────────────────────── */
.profile-header {
    display:        flex;
    flex-direction: column;
    align-items:    center;
    padding:        var(--sp-6) var(--sp-5) var(--sp-4);
    gap:            var(--sp-3);
    border-bottom:  1px solid var(--border);
}
.profile-avatar-wrap {
    position:       relative;
    cursor:         pointer;
}
.profile-name {
    font-size:      var(--font-size-xl);
    font-weight:    var(--font-weight-bold);
    text-align:     center;
    display:        flex;
    align-items:    center;
    gap:            var(--sp-1);
    flex-wrap:      wrap;
    justify-content:center;
}
.profile-status {
    font-size:      var(--font-size-sm);
    color:          var(--text-tertiary);
}
.profile-status[data-status="online"] { color: var(--online); }
.profile-bio {
    font-size:      var(--font-size-sm);
    color:          var(--text-secondary);
    text-align:     center;
    line-height:    1.6;
    padding:        0 var(--sp-4);
}
.profile-username,
.profile-phone {
    font-size:      var(--font-size-sm);
    color:          var(--text-secondary);
    cursor:         pointer;
    padding:        4px 10px;
    border-radius:  var(--radius-full);
    transition:     background var(--transition-fast);
}
.profile-username:hover,
.profile-phone:hover    { background: var(--bg-surface-2); }

/* Action buttons bar */
.profile-actions {
    display:        flex;
    gap:            var(--sp-3);
    padding:        0 var(--sp-4);
    flex-wrap:      wrap;
    justify-content:center;
    margin-top:     var(--sp-2);
}
.action-btn {
    display:        flex;
    flex-direction: column;
    align-items:    center;
    gap:            var(--sp-1);
    padding:        var(--sp-2) var(--sp-3);
    border-radius:  var(--radius-lg);
    background:     var(--brand-alpha-10);
    color:          var(--brand);
    min-width:      60px;
    transition:     background var(--transition-fast), transform var(--transition-spring);
}
.action-btn:hover       { background: var(--brand-alpha-20); transform: translateY(-2px); }
.action-btn:active      { transform: scale(.95); }
.action-btn--inactive   { background: var(--bg-surface-2); color: var(--text-secondary); }
.action-btn__icon svg   { width: 22px; height: 22px; }
.action-btn__label {
    font-size:      var(--font-size-xs);
    font-weight:    var(--font-weight-medium);
}

/* Profile tabs */
.profile-tabs {
    display:        flex;
    border-bottom:  1px solid var(--border);
    position:       sticky;
    top:            0;
    background:     var(--bg-sidebar);
    z-index:        var(--z-above);
    flex-shrink:    0;
}
.profile-tab {
    flex:           1;
    display:        flex;
    flex-direction: column;
    align-items:    center;
    padding:        var(--sp-3) var(--sp-2);
    font-size:      var(--font-size-xs);
    color:          var(--text-secondary);
    gap:            3px;
    transition:     color var(--transition-fast);
    position:       relative;
}
.profile-tab.active         { color: var(--brand); }
.profile-tab.active::after  {
    content:        '';
    position:       absolute;
    bottom:         0;
    inset-inline-start: 10%;
    width:          80%;
    height:         2px;
    background:     var(--brand);
    border-radius:  2px 2px 0 0;
}
.tab-count {
    font-weight:    var(--font-weight-semi);
    font-size:      var(--font-size-sm);
}

/* Media grid */
.profile-media-grid {
    display:        grid;
    grid-template-columns: repeat(3, 1fr);
    gap:            2px;
    padding:        var(--sp-2);
}
.media-thumb {
    aspect-ratio:   1;
    background:     var(--bg-surface-3);
    border-radius:  var(--radius-sm);
    overflow:       hidden;
    cursor:         pointer;
    position:       relative;
    transition:     opacity var(--transition-fast);
}
.media-thumb:hover          { opacity: .88; }
.media-thumb img            { width: 100%; height: 100%; object-fit: cover; }
.media-thumb--video::before {
    content:        '▶';
    position:       absolute;
    inset:          0;
    display:        flex;
    align-items:    center;
    justify-content:center;
    font-size:      20px;
    color:          #fff;
    text-shadow:    0 1px 4px rgba(0,0,0,.5);
}
.media-thumb--skeleton {
    background: linear-gradient(
            90deg,
            var(--bg-surface-3) 25%,
            var(--bg-surface-2) 50%,
            var(--bg-surface-3) 75%
    );
    background-size: 200% 100%;
    animation:      shimmer 1.4s ease-in-out infinite;
}

/* Shared doc list */
.shared-doc {
    display:        flex;
    align-items:    center;
    gap:            var(--sp-3);
    padding:        var(--sp-3) var(--sp-4);
    transition:     background var(--transition-fast);
    text-decoration:none;
    color:          inherit;
}
.shared-doc:hover           { background: var(--bg-surface-2); }
.shared-doc__icon           { font-size: 24px; flex-shrink: 0; }
.shared-doc__info           { flex: 1; min-width: 0; }
.shared-doc__name           { font-size: var(--font-size-sm); font-weight: var(--font-weight-medium); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.shared-doc__meta           { font-size: var(--font-size-xs); color: var(--text-tertiary); margin-top: 2px; }
.shared-doc__dl             { color: var(--brand); flex-shrink: 0; }
.shared-doc__dl svg         { width: 18px; height: 18px; }

/* Shared link list */
.shared-link {
    display:        flex;
    gap:            var(--sp-3);
    padding:        var(--sp-3) var(--sp-4);
    transition:     background var(--transition-fast);
    text-decoration:none;
    color:          inherit;
}
.shared-link:hover          { background: var(--bg-surface-2); }
.shared-link__img,
.shared-link__img-placeholder {
    width:          64px;
    height:         48px;
    border-radius:  var(--radius-md);
    object-fit:     cover;
    flex-shrink:    0;
    background:     var(--bg-surface-3);
    display:        flex;
    align-items:    center;
    justify-content:center;
}
.shared-link__body          { flex: 1; min-width: 0; }
.shared-link__title         { font-size: var(--font-size-sm); font-weight: var(--font-weight-medium); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.shared-link__domain        { font-size: var(--font-size-xs); color: var(--brand); margin-top: 2px; }
.shared-link__date          { font-size: var(--font-size-xs); color: var(--text-tertiary); margin-top: 2px; }

/* Member list */
.member-item {
    display:        flex;
    align-items:    center;
    gap:            var(--sp-3);
    padding:        10px var(--sp-4);
    cursor:         pointer;
    transition:     background var(--transition-fast);
}
.member-item:hover          { background: var(--bg-surface-2); }
.member-item--add           { color: var(--brand); }
.member-item__avatar        { flex-shrink: 0; }
.member-item__avatar--add {
    width:          44px;
    height:         44px;
    border-radius:  50%;
    background:     var(--brand-alpha-10);
    color:          var(--brand);
    display:        flex;
    align-items:    center;
    justify-content:center;
}
.member-item__avatar--add svg { width: 22px; height: 22px; }
.member-item__info          { flex: 1; min-width: 0; }
.member-item__name          { font-size: var(--font-size-sm); font-weight: var(--font-weight-medium); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; display: flex; align-items: center; gap: var(--sp-1); }
.member-item__role          { font-size: var(--font-size-xs); color: var(--text-tertiary); margin-top: 2px; }
.member-item__role--owner   { color: var(--warning); }
.member-item__role--admin   { color: var(--brand); }
.member-item__status        { font-size: var(--font-size-xs); color: var(--online); }
.member-item__more          {
    width:          30px;
    height:         30px;
    border-radius:  50%;
    color:          var(--text-tertiary);
    display:        flex;
    align-items:    center;
    justify-content:center;
    transition:     background var(--transition-fast);
    flex-shrink:    0;
}
.member-item__more:hover    { background: var(--bg-surface-2); }
.member-item__more svg      { width: 16px; height: 16px; }

/* Mutual groups */
.profile-mutual-groups      { padding: var(--sp-4); }
.mutual-groups__title       { font-size: var(--font-size-sm); font-weight: var(--font-weight-semi); color: var(--text-secondary); margin-bottom: var(--sp-3); }
.mutual-groups__list        { display: flex; flex-direction: column; gap: var(--sp-1); }
.mutual-group-item {
    display:        flex;
    align-items:    center;
    gap:            var(--sp-3);
    padding:        var(--sp-2) var(--sp-3);
    border-radius:  var(--radius-lg);
    cursor:         pointer;
    transition:     background var(--transition-fast);
}
.mutual-group-item:hover    { background: var(--bg-surface-2); }
.mutual-group-item__name    { flex: 1; font-size: var(--font-size-sm); }
.mutual-group-item__count   { font-size: var(--font-size-xs); color: var(--text-tertiary); }

/* Profile bottom danger actions */
.profile-danger-section {
    padding:        var(--sp-4);
    display:        flex;
    flex-direction: column;
    gap:            var(--sp-2);
    border-top:     1px solid var(--border);
    margin-top:     auto;
}
.profile-danger-btn {
    display:        flex;
    align-items:    center;
    gap:            var(--sp-3);
    padding:        var(--sp-3) var(--sp-4);
    border-radius:  var(--radius-lg);
    color:          var(--danger);
    font-size:      var(--font-size-sm);
    font-weight:    var(--font-weight-medium);
    transition:     background var(--transition-fast);
    width:          100%;
    text-align:     start;
}
.profile-danger-btn:hover   { background: var(--danger-bg); }
.profile-danger-btn svg     { width: 18px; height: 18px; flex-shrink: 0; }

/* ──────────────────────────────────────────────────────────
   6. SETTINGS PAGE
────────────────────────────────────────────────────────── */
.settings-page {
    position:       fixed;
    inset:          0;
    background:     var(--bg-app);
    z-index:        var(--z-modal);
    display:        grid;
    grid-template-columns: 240px 1fr;
    transition:     opacity var(--transition-base);
}
.settings-page--open { animation: fadeIn var(--transition-base) forwards; }

.settings-nav {
    background:     var(--bg-sidebar);
    border-inline-end: 1px solid var(--border);
    padding:        var(--sp-4) var(--sp-2);
    overflow-y:     auto;
    display:        flex;
    flex-direction: column;
    gap:            2px;
}
.settings-nav-item {
    display:        flex;
    align-items:    center;
    gap:            var(--sp-3);
    padding:        10px var(--sp-3);
    border-radius:  var(--radius-md);
    font-size:      var(--font-size-sm);
    color:          var(--text-secondary);
    cursor:         pointer;
    transition:     background var(--transition-fast), color var(--transition-fast);
}
.settings-nav-item:hover    { background: var(--bg-surface-2); color: var(--text-primary); }
.settings-nav-item.active   { background: var(--brand-alpha-10); color: var(--brand); font-weight: var(--font-weight-medium); }
.settings-nav-item__icon    { width: 20px; height: 20px; flex-shrink: 0; font-size: 18px; }
.settings-nav-item__label   { flex: 1; }

.settings-content {
    display:        flex;
    flex-direction: column;
    overflow:       hidden;
}
.settings-content__header {
    height:         var(--header-height);
    border-bottom:  1px solid var(--border);
    padding:        0 var(--sp-6);
    display:        flex;
    align-items:    center;
    font-size:      var(--font-size-lg);
    font-weight:    var(--font-weight-semi);
    flex-shrink:    0;
    gap:            var(--sp-3);
}
.settings-back { color: var(--text-secondary); display: none; }
.settings-content__body { flex: 1; overflow-y: auto; padding: var(--sp-4) var(--sp-6); max-width: 640px; }
.settings-loading { opacity: .5; pointer-events: none; }

/* Settings group */
.settings-group {
    margin-bottom:  var(--sp-5);
}
.settings-group__title {
    font-size:      var(--font-size-xs);
    font-weight:    var(--font-weight-semi);
    color:          var(--text-tertiary);
    text-transform: uppercase;
    letter-spacing: .06em;
    padding:        0 var(--sp-1) var(--sp-2);
}
.settings-group__inner {
    background:     var(--bg-surface);
    border-radius:  var(--radius-xl);
    overflow:       hidden;
    box-shadow:     var(--shadow-xs);
}
.settings-group__inner > * + * { border-top: 1px solid var(--border); }

/* Settings section */
.settings-section {
    margin-bottom:  var(--sp-5);
}
.settings-section__title {
    font-size:      var(--font-size-sm);
    font-weight:    var(--font-weight-semi);
    color:          var(--text-primary);
    margin-bottom:  var(--sp-1);
}
.settings-section__desc {
    font-size:      var(--font-size-xs);
    color:          var(--text-tertiary);
    margin-bottom:  var(--sp-3);
    line-height:    1.6;
}
.settings-section--danger .settings-section__title { color: var(--danger); }

/* Settings row */
.settings-row {
    display:        flex;
    align-items:    center;
    gap:            var(--sp-3);
    padding:        13px var(--sp-4);
    transition:     background var(--transition-fast);
}
.settings-row.disabled      { opacity: .45; pointer-events: none; }
.settings-row--toggle       { justify-content: space-between; }
.settings-row--nav          { cursor: pointer; }
.settings-row--nav:hover    { background: var(--bg-surface-2); }
.settings-row--danger       { color: var(--danger); }
.settings-row__label        { flex: 1; font-size: var(--font-size-sm); }
.settings-row__value        { font-size: var(--font-size-sm); color: var(--text-tertiary); }
.settings-row__arrow        { width: 16px; height: 16px; color: var(--text-tertiary); }
.settings-row--info .settings-row__value { font-feature-settings: 'tnum'; }

/* Select */
.settings-select-wrap       { position: relative; }
.settings-select {
    appearance:     none;
    background:     var(--bg-input);
    border-radius:  var(--radius-md);
    padding:        6px 28px 6px 12px;
    font-size:      var(--font-size-sm);
    color:          var(--text-primary);
    cursor:         pointer;
    border:         1px solid transparent;
    min-width:      120px;
    transition:     border-color var(--transition-fast);
}
.settings-select:focus      { border-color: var(--brand); }
.settings-select-arrow {
    position:       absolute;
    inset-inline-end: 8px;
    top:            50%;
    transform:      translateY(-50%);
    pointer-events: none;
    font-size:      10px;
    color:          var(--text-tertiary);
}

/* Segment */
.settings-segment {
    display:        flex;
    background:     var(--bg-input);
    border-radius:  var(--radius-lg);
    padding:        3px;
    gap:            2px;
}
.settings-segment__btn {
    flex:           1;
    padding:        7px var(--sp-3);
    border-radius:  var(--radius-md);
    font-size:      var(--font-size-sm);
    color:          var(--text-secondary);
    display:        flex;
    align-items:    center;
    justify-content:center;
    gap:            var(--sp-1);
    transition:     background var(--transition-fast), color var(--transition-fast), box-shadow var(--transition-fast);
}
.settings-segment__btn.active {
    background:     var(--bg-surface);
    color:          var(--text-primary);
    box-shadow:     var(--shadow-xs);
}

/* Slider */
.settings-slider-wrap {
    display:        flex;
    align-items:    center;
    gap:            var(--sp-3);
    padding:        var(--sp-1) 0;
    flex: 1;
}
.settings-slider-track { flex: 1; }
.settings-slider {
    width:          100%;
    appearance:     none;
    height:         4px;
    border-radius:  var(--radius-full);
    background:     linear-gradient(
            to left,
            var(--bg-surface-3) 0%,
            var(--bg-surface-3) calc(100% - var(--pct, 50%)),
            var(--brand) calc(100% - var(--pct, 50%)),
            var(--brand) 100%
    );
    cursor:         pointer;
    outline:        none;
}
.settings-slider::-webkit-slider-thumb {
    appearance:     none;
    width:          20px;
    height:         20px;
    border-radius:  50%;
    background:     var(--bg-surface);
    border:         2px solid var(--brand);
    box-shadow:     var(--shadow-sm);
    transition:     transform var(--transition-spring);
}
.settings-slider::-webkit-slider-thumb:hover  { transform: scale(1.15); }
.settings-slider::-webkit-slider-thumb:active { transform: scale(.95);  }
.settings-slider-val {
    font-size:      var(--font-size-xs);
    color:          var(--text-secondary);
    white-space:    nowrap;
    min-width:      40px;
    text-align:     center;
}

/* Color picker */
.color-picker {
    display:        flex;
    flex-wrap:      wrap;
    gap:            var(--sp-2);
    padding:        var(--sp-3) var(--sp-4);
}
.color-swatch {
    width:          32px;
    height:         32px;
    border-radius:  50%;
    background:     var(--swatch);
    transition:     transform var(--transition-spring), box-shadow var(--transition-fast);
    position:       relative;
}
.color-swatch:hover         { transform: scale(1.15); }
.color-swatch.active {
    box-shadow:     0 0 0 3px var(--bg-surface), 0 0 0 5px var(--swatch);
    transform:      scale(1.1);
}

/* Chat bg picker */
.chat-bg-picker {
    display:        flex;
    gap:            var(--sp-2);
    padding:        var(--sp-3) var(--sp-4);
    flex-wrap:      wrap;
}
.chat-bg-option {
    width:          56px;
    height:         40px;
    border-radius:  var(--radius-md);
    border:         2px solid transparent;
    transition:     border-color var(--transition-fast), transform var(--transition-spring);
    font-size:      20px;
    display:        flex;
    align-items:    center;
    justify-content:center;
    overflow:       hidden;
}
.chat-bg-option:hover       { transform: scale(1.05); }
.chat-bg-option.active      { border-color: var(--brand); }

/* Appearance preview */
.appearance-preview {
    background:     var(--bg-surface-2);
    border-radius:  var(--radius-xl);
    padding:        var(--sp-4);
    margin-top:     var(--sp-2);
}
.appearance-preview__label {
    font-size:      var(--font-size-xs);
    color:          var(--text-tertiary);
    margin-bottom:  var(--sp-3);
    text-transform: uppercase;
    letter-spacing: .06em;
}
.appearance-preview__chat {
    display:        flex;
    flex-direction: column;
    gap:            var(--sp-2);
}

/* Action row */
.settings-action-row {
    display:        flex;
    align-items:    center;
    justify-content:space-between;
    gap:            var(--sp-3);
    padding:        var(--sp-4);
    background:     var(--bg-surface);
    border-radius:  var(--radius-xl);
    margin-bottom:  var(--sp-3);
    box-shadow:     var(--shadow-xs);
}
.settings-action-row--danger { border: 1px solid var(--danger-bg); }
.settings-action-row__title  { font-size: var(--font-size-sm); font-weight: var(--font-weight-medium); }
.settings-action-row__desc   { font-size: var(--font-size-xs); color: var(--text-tertiary); margin-top: 2px; }

/* Storage usage */
.storage-usage {
    background:     var(--bg-surface);
    border-radius:  var(--radius-xl);
    padding:        var(--sp-5);
    margin-bottom:  var(--sp-5);
    box-shadow:     var(--shadow-xs);
}
.storage-usage__bar-wrap {
    height:         8px;
    background:     var(--bg-surface-3);
    border-radius:  var(--radius-full);
    overflow:       hidden;
    margin-bottom:  var(--sp-3);
}
.storage-usage__bar {
    height:         100%;
    background:     linear-gradient(90deg, var(--brand), var(--brand-light));
    border-radius:  var(--radius-full);
    transition:     width .6s ease;
}
.storage-usage__labels {
    display:        flex;
    justify-content:space-between;
    font-size:      var(--font-size-xs);
    color:          var(--text-secondary);
    margin-bottom:  var(--sp-1);
}
.storage-usage__total { font-size: var(--font-size-xs); color: var(--text-tertiary); text-align: center; }

.storage-cat-row {
    display:        flex;
    align-items:    center;
    gap:            var(--sp-3);
    padding:        10px var(--sp-4);
}
.storage-cat-row__icon { font-size: 20px; flex-shrink: 0; width: 28px; text-align: center; }
.storage-cat-row__info { flex: 1; min-width: 0; }
.storage-cat-row__label{ font-size: var(--font-size-sm); margin-bottom: 4px; }
.storage-cat-row__bar-wrap {
    height:         4px;
    background:     var(--bg-surface-3);
    border-radius:  var(--radius-full);
    overflow:       hidden;
}
.storage-cat-row__bar {
    height:         100%;
    background:     var(--brand);
    border-radius:  var(--radius-full);
    transition:     width .4s ease;
}
.storage-cat-row__size { font-size: var(--font-size-xs); color: var(--text-tertiary); flex-shrink: 0; }
.storage-cat-row__clear{ flex-shrink: 0; }

/* Devices */
.device-row {
    display:        flex;
    align-items:    flex-start;
    gap:            var(--sp-3);
    padding:        var(--sp-4);
}
.device-row__icon   { font-size: 28px; flex-shrink: 0; }
.device-row__info   { flex: 1; min-width: 0; }
.device-row__name   { font-size: var(--font-size-sm); font-weight: var(--font-weight-semi); }
.device-row__meta   {
    font-size:      var(--font-size-xs);
    color:          var(--text-tertiary);
    margin-top:     3px;
    display:        flex;
    flex-wrap:      wrap;
    gap:            4px;
}
.device-row__location { font-size: var(--font-size-xs); color: var(--text-tertiary); margin-top: 2px; }
.device-row__badge {
    font-size:      var(--font-size-xs);
    color:          var(--success);
    font-weight:    var(--font-weight-semi);
    flex-shrink:    0;
}

/* Language list */
.lang-list { display: flex; flex-direction: column; }
.lang-item {
    display:        flex;
    align-items:    center;
    gap:            var(--sp-3);
    padding:        12px var(--sp-4);
    cursor:         pointer;
    transition:     background var(--transition-fast);
}
.lang-item:hover            { background: var(--bg-surface-2); }
.lang-item--active          { background: var(--brand-alpha-10); }
.lang-item__flag            { font-size: 22px; flex-shrink: 0; }
.lang-item__name            { flex: 1; font-size: var(--font-size-sm); }
.lang-item__check           { width: 16px; height: 16px; color: var(--brand); }

/* Settings logout */
.settings-logout {
    margin:         var(--sp-4) 0;
}

/* Settings empty */
.settings-empty {
    display:        flex;
    flex-direction: column;
    align-items:    center;
    justify-content:center;
    gap:            var(--sp-3);
    padding:        var(--sp-10);
    color:          var(--text-tertiary);
    text-align:     center;
}
.settings-empty__icon { font-size: 40px; }
.settings-empty__text { font-size: var(--font-size-sm); }

/* Account profile card */
.account-profile-card {
    display:        flex;
    align-items:    center;
    gap:            var(--sp-4);
    padding:        var(--sp-5);
    background:     var(--bg-surface);
    border-radius:  var(--radius-xl);
    margin-bottom:  var(--sp-5);
    box-shadow:     var(--shadow-xs);
}
.account-profile-card__info { flex: 1; min-width: 0; }
.account-profile-card__name { font-size: var(--font-size-md); font-weight: var(--font-weight-semi); }
.account-profile-card__username { font-size: var(--font-size-sm); color: var(--brand); }
.account-profile-card__phone    { font-size: var(--font-size-xs); color: var(--text-tertiary); }

/* 2FA QR */
.qr-code, .qr-image {
    display:        block;
    margin:         var(--sp-4) auto;
    border-radius:  var(--radius-lg);
    border:         8px solid #fff;
    box-shadow:     var(--shadow-md);
    max-width:      200px;
}
.secret-code {
    display:        block;
    background:     var(--bg-surface-2);
    border-radius:  var(--radius-md);
    padding:        var(--sp-3);
    font-size:      var(--font-size-sm);
    text-align:     center;
    letter-spacing: .1em;
    word-break:     break-all;
    margin:         var(--sp-3) 0;
}
.bio-char-count {
    font-size:      var(--font-size-xs);
    color:          var(--text-tertiary);
    text-align:     end;
}
.bio-char-count.over { color: var(--danger); }
.username-hint {
    font-size:      var(--font-size-xs);
    margin-top:     4px;
}
.username-hint[data-status="ok"]    { color: var(--success); }
.username-hint[data-status="error"] { color: var(--danger); }

/* ──────────────────────────────────────────────────────────
   7. CONTACTS PAGE
────────────────────────────────────────────────────────── */
.contacts-page {
    display:        flex;
    flex-direction: column;
    height:         100dvh;
    overflow:       hidden;
    background:     var(--bg-sidebar);
    position:       relative;
}
.contacts-list { flex: 1; overflow-y: auto; padding: var(--sp-1) 0; }

.contacts-section-header {
    padding:        var(--sp-2) var(--sp-4);
    font-size:      var(--font-size-xs);
    font-weight:    var(--font-weight-semi);
    color:          var(--text-tertiary);
    position:       sticky;
    top:            0;
    background:     var(--bg-sidebar);
    z-index:        1;
}

.contact-row {
    display:        flex;
    align-items:    center;
    gap:            var(--sp-3);
    padding:        10px var(--sp-4);
    cursor:         pointer;
    transition:     background var(--transition-fast);
    position:       relative;
}
.contact-row:hover          { background: var(--bg-surface-2); }
.contact-row--selected      { background: var(--brand-alpha-10); }
.contact-row__check {
    width:          20px;
    height:         20px;
    border-radius:  50%;
    border:         2px solid var(--border-strong);
    display:        flex;
    align-items:    center;
    justify-content:center;
    flex-shrink:    0;
    color:          var(--brand);
    transition:     background var(--transition-fast), border-color var(--transition-fast);
}
.contact-row--selected .contact-row__check { background: var(--brand); border-color: var(--brand); color: #fff; }
.contacts-select-mode .contact-row__check  { width: 20px; }
.contact-row__avatar        { flex-shrink: 0; }
.contact-row__info          { flex: 1; min-width: 0; }
.contact-row__name {
    font-size:      var(--font-size-sm);
    font-weight:    var(--font-weight-medium);
    overflow:       hidden;
    text-overflow:  ellipsis;
    white-space:    nowrap;
    display:        flex;
    align-items:    center;
    gap:            var(--sp-1);
}
.contact-row__sub {
    font-size:      var(--font-size-xs);
    color:          var(--text-tertiary);
    margin-top:     2px;
}
.contact-row__sub[data-status="online"] { color: var(--online); }
.contact-row__fav { font-size: 12px; }

/* Favorites horizontal row */
.contacts-favs              { overflow: hidden; padding: var(--sp-3) 0; border-bottom: 1px solid var(--border); }
.contacts-favs__scroll      { display: flex; gap: var(--sp-4); overflow-x: auto; padding: 0 var(--sp-4); scrollbar-width: none; }
.contacts-favs__scroll::-webkit-scrollbar { display: none; }
.contacts-fav-item {
    display:        flex;
    flex-direction: column;
    align-items:    center;
    gap:            var(--sp-1);
    cursor:         pointer;
    flex-shrink:    0;
}
.contacts-fav-item__name {
    font-size:      var(--font-size-xs);
    text-align:     center;
    max-width:      60px;
    overflow:       hidden;
    text-overflow:  ellipsis;
    white-space:    nowrap;
    color:          var(--text-secondary);
}

/* Contact requests row */
.contact-requests-row {
    display:        flex;
    align-items:    center;
    gap:            var(--sp-3);
    padding:        12px var(--sp-4);
    cursor:         pointer;
    transition:     background var(--transition-fast);
    border-bottom:  1px solid var(--border);
}
.contact-requests-row:hover { background: var(--bg-surface-2); }
.contact-requests-row__icon { font-size: 24px; flex-shrink: 0; }
.contact-requests-row__info { flex: 1; }
.contact-requests-row__title{ font-size: var(--font-size-sm); font-weight: var(--font-weight-semi); }
.contact-requests-row__sub  { font-size: var(--font-size-xs); color: var(--text-tertiary); }
.contact-requests-row__badge{
    min-width:      20px;
    height:         20px;
    background:     var(--brand);
    color:          #fff;
    border-radius:  var(--radius-full);
    font-size:      var(--font-size-xs);
    font-weight:    var(--font-weight-bold);
    display:        flex;
    align-items:    center;
    justify-content:center;
    padding:        0 5px;
}

/* Alphabet sidebar */
.contacts-alphabet {
    position:       fixed;
    inset-inline-end: 4px;
    top:            50%;
    transform:      translateY(-50%);
    display:        flex;
    flex-direction: column;
    gap:            1px;
    z-index:        var(--z-above);
}
.alphabet-btn {
    width:          18px;
    height:         18px;
    font-size:      10px;
    border-radius:  50%;
    color:          var(--text-tertiary);
    display:        flex;
    align-items:    center;
    justify-content:center;
    transition:     background var(--transition-fast), color var(--transition-fast);
}
.alphabet-btn:hover         { background: var(--brand-alpha-10); color: var(--brand); }

/* Select bar */
.contacts-select-bar {
    position:       sticky;
    bottom:         0;
    background:     var(--bg-modal);
    border-top:     1px solid var(--border);
    display:        flex;
    align-items:    center;
    gap:            var(--sp-3);
    padding:        var(--sp-3) var(--sp-4);
    z-index:        var(--z-above);
    box-shadow:     0 -4px 16px rgba(0,0,0,.08);
}
.contacts-select-bar__count { flex: 1; font-size: var(--font-size-sm); font-weight: var(--font-weight-medium); }

/* Contact picker (modal) */
.contact-picker-item {
    display:        flex;
    align-items:    center;
    gap:            var(--sp-3);
    padding:        10px var(--sp-4);
    cursor:         pointer;
    transition:     background var(--transition-fast);
}
.contact-picker-item:hover  { background: var(--bg-surface-2); }
.contact-picker-item--selected{ background: var(--brand-alpha-10); }
.contact-picker-item--member  { opacity: .5; pointer-events: none; }
.contact-picker-item__info  { flex: 1; min-width: 0; }
.contact-picker-item__name  { font-size: var(--font-size-sm); font-weight: var(--font-weight-medium); }
.contact-picker-item__sub   { font-size: var(--font-size-xs); color: var(--text-tertiary); }
.contact-picker-item__check {
    width:          20px;
    height:         20px;
    border:         2px solid var(--border-strong);
    border-radius:  50%;
    flex-shrink:    0;
    transition:     background var(--transition-fast), border-color var(--transition-fast);
}
.contact-picker-item--selected .contact-picker-item__check {
    background:     var(--brand);
    border-color:   var(--brand);
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3E%3Cpath d='M3 8l3 3 7-7' stroke='%23fff' stroke-width='2' fill='none'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: center;
}

/* User search result */
.user-search-item {
    display:        flex;
    align-items:    center;
    gap:            var(--sp-3);
    padding:        10px var(--sp-3);
    border-radius:  var(--radius-lg);
    transition:     background var(--transition-fast);
}
.user-search-item:hover     { background: var(--bg-surface-2); }
.user-search-item__info     { flex: 1; min-width: 0; }
.user-search-item__name     { font-size: var(--font-size-sm); font-weight: var(--font-weight-medium); }
.user-search-item__sub      { font-size: var(--font-size-xs); color: var(--text-tertiary); }
.user-search-item__tag      { font-size: var(--font-size-xs); color: var(--text-tertiary); }

/* QR code */
.qr-fallback {
    display:        block;
    padding:        var(--sp-4);
    background:     var(--bg-surface-2);
    border-radius:  var(--radius-lg);
    text-align:     center;
    letter-spacing: .1em;
    font-size:      var(--font-size-sm);
    margin:         var(--sp-4) 0;
    word-break:     break-all;
}
#qrVideo {
    width:          100%;
    border-radius:  var(--radius-lg);
    margin:         var(--sp-3) 0;
    max-height:     240px;
    object-fit:     cover;
}

/* Invite link */
#inviteLinkWrap {
    display:        block;
    background:     var(--bg-surface-2);
    padding:        var(--sp-3);
    border-radius:  var(--radius-lg);
    font-size:      var(--font-size-sm);
    color:          var(--text-secondary);
    word-break:     break-all;
    margin-bottom:  var(--sp-3);
    cursor:         pointer;
    transition:     background var(--transition-fast);
}
#inviteLinkWrap:hover { background: var(--bg-surface-3); }

.social-share-btn {
    display:        inline-flex;
    align-items:    center;
    justify-content:center;
    width:          44px;
    height:         44px;
    border-radius:  50%;
    font-size:      22px;
    background:     var(--bg-surface-2);
    transition:     transform var(--transition-spring), background var(--transition-fast);
}
.social-share-btn:hover { transform: scale(1.12); }

/* ──────────────────────────────────────────────────────────
   8. MEDIA VIEWER (full-screen)
────────────────────────────────────────────────────────── */
.media-viewer {
    position:       fixed;
    inset:          0;
    background:     rgba(0,0,0,.95);
    z-index:        var(--z-max);
    display:        flex;
    align-items:    center;
    justify-content:center;
    opacity:        0;
}
.media-viewer--open { animation: fadeIn 200ms ease forwards; }
.media-viewer__img,
.media-viewer__video {
    max-width:      90vw;
    max-height:     90dvh;
    border-radius:  var(--radius-lg);
    box-shadow:     var(--shadow-xl);
    object-fit:     contain;
}
.media-viewer__close,
.media-viewer__prev,
.media-viewer__next {
    position:       absolute;
    background:     rgba(255,255,255,.15);
    color:          #fff;
    border-radius:  50%;
    width:          44px;
    height:         44px;
    display:        flex;
    align-items:    center;
    justify-content:center;
    font-size:      22px;
    transition:     background var(--transition-fast);
    backdrop-filter:var(--blur-sm);
}
.media-viewer__close:hover,
.media-viewer__prev:hover,
.media-viewer__next:hover   { background: rgba(255,255,255,.28); }
.media-viewer__close        { top: var(--sp-4); inset-inline-end: var(--sp-4); }
.media-viewer__prev         { inset-inline-start: var(--sp-4); }
.media-viewer__next         { inset-inline-end:   var(--sp-4); }
.media-viewer__counter {
    position:       absolute;
    bottom:         var(--sp-6);
    left:           50%;
    transform:      translateX(-50%);
    color:          rgba(255,255,255,.7);
    font-size:      var(--font-size-sm);
    background:     rgba(0,0,0,.4);
    padding:        4px 14px;
    border-radius:  var(--radius-full);
    backdrop-filter:var(--blur-sm);
}
.media-viewer__dl {
    position:       absolute;
    bottom:         var(--sp-4);
    inset-inline-end: var(--sp-4);
    color:          rgba(255,255,255,.7);
    font-size:      20px;
    width:          40px;
    height:         40px;
    display:        flex;
    align-items:    center;
    justify-content:center;
    border-radius:  50%;
    background:     rgba(255,255,255,.15);
    transition:     background var(--transition-fast);
}
.media-viewer__dl:hover     { background: rgba(255,255,255,.28); }
.media-viewer-open          { overflow: hidden; }

/* Avatar viewer */
.avatar-viewer {
    position:       fixed;
    inset:          0;
    background:     rgba(0,0,0,.92);
    z-index:        var(--z-max);
    display:        flex;
    align-items:    center;
    justify-content:center;
    opacity:        0;
    animation:      fadeIn 200ms ease forwards;
}
.avatar-viewer--open { opacity: 1; }
.avatar-viewer__img {
    max-width:      min(420px, 90vw);
    max-height:     min(420px, 90dvh);
    border-radius:  50%;
    box-shadow:     var(--shadow-xl);
    object-fit:     cover;
}
.avatar-viewer__close {
    position:       absolute;
    top:            var(--sp-4);
    inset-inline-end: var(--sp-4);
    color:          #fff;
    font-size:      28px;
    background:     rgba(255,255,255,.15);
    border-radius:  50%;
    width:          44px;
    height:         44px;
    display:        flex;
    align-items:    center;
    justify-content:center;
}
.avatar-viewer__title {
    position:       absolute;
    bottom:         var(--sp-8);
    left:           50%;
    transform:      translateX(-50%);
    color:          #fff;
    font-size:      var(--font-size-lg);
    font-weight:    var(--font-weight-semi);
    text-shadow:    0 2px 8px rgba(0,0,0,.5);
}

/* ──────────────────────────────────────────────────────────
   9. CALL OVERLAY
────────────────────────────────────────────────────────── */
.call-overlay {
    position:       fixed;
    inset:          0;
    background:     linear-gradient(160deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
    z-index:        var(--z-call);
    display:        flex;
    flex-direction: column;
    align-items:    center;
    justify-content:space-between;
    padding:        env(safe-area-inset-top, 40px) var(--sp-6) env(safe-area-inset-bottom, 40px);
    color:          #fff;
}
.call-avatar        { animation: callPulse 2.5s ease-in-out infinite; }
.call-name          { font-size: var(--font-size-2xl); font-weight: var(--font-weight-bold); margin-top: var(--sp-4); }
.call-status        { font-size: var(--font-size-sm); opacity: .7; margin-top: var(--sp-2); }
.call-timer         { font-size: var(--font-size-lg); font-feature-settings: 'tnum'; opacity: .9; }
.call-actions {
    display:        flex;
    gap:            var(--sp-6);
    align-items:    center;
    margin-bottom:  var(--sp-6);
}
.call-btn {
    display:        flex;
    flex-direction: column;
    align-items:    center;
    gap:            var(--sp-2);
    color:          #fff;
}
.call-btn__circle {
    width:          60px;
    height:         60px;
    border-radius:  50%;
    background:     rgba(255,255,255,.2);
    display:        flex;
    align-items:    center;
    justify-content:center;
    font-size:      24px;
    transition:     background var(--transition-fast), transform var(--transition-spring);
    backdrop-filter:var(--blur-sm);
}
.call-btn__circle:hover     { background: rgba(255,255,255,.3); transform: scale(1.08); }
.call-btn__circle:active    { transform: scale(.95); }
.call-btn--end .call-btn__circle   { background: var(--danger); width: 72px; height: 72px; font-size: 28px; }
.call-btn--answer .call-btn__circle{ background: var(--success); width: 72px; height: 72px; font-size: 28px; }
.call-btn__label { font-size: var(--font-size-xs); opacity: .8; }

/* Mini call bar */
.call-mini-bar {
    position:       fixed;
    top:            env(safe-area-inset-top, 0);
    left:           0;
    right:          0;
    background:     var(--success);
    color:          #fff;
    display:        flex;
    align-items:    center;
    gap:            var(--sp-3);
    padding:        var(--sp-2) var(--sp-4);
    z-index:        var(--z-call);
    cursor:         pointer;
    animation:      slideDown 200ms var(--transition-spring) forwards;
}
.call-mini-bar__timer { font-size: var(--font-size-sm); font-feature-settings: 'tnum'; flex: 1; }
.call-mini-bar__end   { background: var(--danger); border-radius: var(--radius-full); padding: 4px 14px; font-size: var(--font-size-xs); font-weight: var(--font-weight-semi); }

/* ──────────────────────────────────────────────────────────
   10. SKELETON LOADERS
────────────────────────────────────────────────────────── */
@keyframes shimmer {
    0%   { background-position: 200% 0; }
    100% { background-position: -200% 0; }
}

.skeleton-base {
    background: linear-gradient(
            90deg,
            var(--bg-surface-3) 25%,
            var(--bg-surface-2) 50%,
            var(--bg-surface-3) 75%
    );
    background-size: 200% 100%;
    animation:      shimmer 1.4s ease-in-out infinite;
    border-radius:  var(--radius-sm);
}

/* Chat skeleton */
.chat-skeleton {
    display:        flex;
    align-items:    center;
    gap:            var(--sp-3);
    padding:        10px var(--sp-4);
    margin:         1px var(--sp-2);
}
.chat-skeleton__avatar {
    width:          var(--avatar-md);
    height:         var(--avatar-md);
    border-radius:  50%;
    flex-shrink:    0;
    @extend .skeleton-base;
    background: linear-gradient(90deg, var(--bg-surface-3) 25%, var(--bg-surface-2) 50%, var(--bg-surface-3) 75%);
    background-size: 200% 100%;
    animation:      shimmer 1.4s ease-in-out infinite;
}
.chat-skeleton__body        { flex: 1; display: flex; flex-direction: column; gap: var(--sp-2); }
.chat-skeleton__name,
.chat-skeleton__msg         {
    height:         12px;
    border-radius:  var(--radius-sm);
    background:     linear-gradient(90deg, var(--bg-surface-3) 25%, var(--bg-surface-2) 50%, var(--bg-surface-3) 75%);
    background-size: 200% 100%;
    animation:      shimmer 1.4s ease-in-out infinite;
}
.chat-skeleton__name        { width: 55%; }
.chat-skeleton__msg         { width: 80%; height: 10px; }

/* Contact skeleton */
.contact-skeleton           { @extend .chat-skeleton; }
.contact-skeleton__avatar   { @extend .chat-skeleton__avatar; }
.contact-skeleton__body     { @extend .chat-skeleton__body; }
.contact-skeleton__name,
.contact-skeleton__sub      { @extend .chat-skeleton__name; background: linear-gradient(90deg, var(--bg-surface-3) 25%, var(--bg-surface-2) 50%, var(--bg-surface-3) 75%); background-size: 200% 100%; animation: shimmer 1.4s ease-in-out infinite; }
.contact-skeleton__sub      { width: 40%; height: 10px; }

/* Profile skeleton */
.profile-skeleton {
    display:        flex;
    flex-direction: column;
    align-items:    center;
    gap:            var(--sp-3);
    padding:        var(--sp-8) var(--sp-4);
}
.profile-skeleton__avatar {
    width:          var(--avatar-xl);
    height:         var(--avatar-xl);
    border-radius:  50%;
    background:     linear-gradient(90deg, var(--bg-surface-3) 25%, var(--bg-surface-2) 50%, var(--bg-surface-3) 75%);
    background-size:200% 100%;
    animation:      shimmer 1.4s ease-in-out infinite;
}
.profile-skeleton__name,
.profile-skeleton__status,
.profile-skeleton__bio {
    border-radius:  var(--radius-full);
    background:     linear-gradient(90deg, var(--bg-surface-3) 25%, var(--bg-surface-2) 50%, var(--bg-surface-3) 75%);
    background-size:200% 100%;
    animation:      shimmer 1.4s ease-in-out infinite;
}
.profile-skeleton__name     { width: 140px; height: 18px; }
.profile-skeleton__status   { width: 90px;  height: 12px; }
.profile-skeleton__bio      { width: 200px; height: 12px; }
.profile-skeleton__actions  { display: flex; gap: var(--sp-3); margin-top: var(--sp-2); }
.profile-skeleton__action-btn {
    width:          60px;
    height:         48px;
    border-radius:  var(--radius-lg);
    background:     linear-gradient(90deg, var(--bg-surface-3) 25%, var(--bg-surface-2) 50%, var(--bg-surface-3) 75%);
    background-size:200% 100%;
    animation:      shimmer 1.4s ease-in-out infinite;
}

/* Message skeletons */
.msg-skeleton {
    display:        flex;
    gap:            var(--sp-2);
    margin-bottom:  var(--sp-2);
}
.msg-skeleton--out { flex-direction: row-reverse; }
.msg-skeleton__bubble {
    height:         40px;
    border-radius:  var(--radius-lg);
    background:     linear-gradient(90deg, var(--bg-surface-3) 25%, var(--bg-surface-2) 50%, var(--bg-surface-3) 75%);
    background-size:200% 100%;
    animation:      shimmer 1.4s ease-in-out infinite;
}
.msg-skeleton--in  .msg-skeleton__bubble { width: 180px; }
.msg-skeleton--out .msg-skeleton__bubble { width: 140px; }

/* ──────────────────────────────────────────────────────────
   11. REACTION PICKER
────────────────────────────────────────────────────────── */
.reaction-picker {
    position:       absolute;
    background:     var(--bg-modal);
    border-radius:  var(--radius-full);
    box-shadow:     var(--shadow-xl);
    border:         1px solid var(--border);
    display:        flex;
    gap:            2px;
    padding:        4px;
    z-index:        var(--z-dropdown);
    animation:      scaleIn 150ms var(--transition-spring) forwards;
}
.reaction-picker__btn {
    width:          38px;
    height:         38px;
    font-size:      22px;
    border-radius:  50%;
    display:        flex;
    align-items:    center;
    justify-content:center;
    transition:     transform var(--transition-spring), background var(--transition-fast);
}
.reaction-picker__btn:hover { transform: scale(1.35) translateY(-4px); background: var(--bg-surface-2); }

/* ──────────────────────────────────────────────────────────
   12. FORWARD MODAL
────────────────────────────────────────────────────────── */
.forward-modal-list         { max-height: 380px; overflow-y: auto; }
.forward-item {
    display:        flex;
    align-items:    center;
    gap:            var(--sp-3);
    padding:        10px var(--sp-4);
    cursor:         pointer;
    transition:     background var(--transition-fast);
}
.forward-item:hover         { background: var(--bg-surface-2); }
.forward-item--selected     { background: var(--brand-alpha-10); }
.forward-item__info         { flex: 1; min-width: 0; }
.forward-item__name         { font-size: var(--font-size-sm); font-weight: var(--font-weight-medium); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.forward-item__sub          { font-size: var(--font-size-xs); color: var(--text-tertiary); }
.forward-item__check {
    width:          20px;
    height:         20px;
    border-radius:  50%;
    border:         2px solid var(--border-strong);
    flex-shrink:    0;
    transition:     background var(--transition-fast), border-color var(--transition-fast);
}
.forward-item--selected .forward-item__check { background: var(--brand); border-color: var(--brand); }

/* ──────────────────────────────────────────────────────────
   13. REQUEST ITEMS
────────────────────────────────────────────────────────── */
.request-item {
    display:        flex;
    align-items:    center;
    gap:            var(--sp-3);
    padding:        var(--sp-3) var(--sp-4);
    border-bottom:  1px solid var(--border);
}
.request-item__info         { flex: 1; min-width: 0; }
.request-item__name         { font-size: var(--font-size-sm); font-weight: var(--font-weight-medium); }
.request-item__sub          { font-size: var(--font-size-xs); color: var(--text-tertiary); margin-top: 2px; }
.request-item__time         { font-size: var(--font-size-xs); color: var(--text-tertiary); margin-top: 2px; }
.request-item__actions      { display: flex; gap: var(--sp-2); flex-shrink: 0; }

/* Blocked users */
.blocked-item {
    display:        flex;
    align-items:    center;
    gap:            var(--sp-3);
    padding:        var(--sp-3) var(--sp-4);
    border-bottom:  1px solid var(--border);
}
.blocked-item__name         { flex: 1; font-size: var(--font-size-sm); }

/* Group chip strip */
#groupSelectedChips {
    display:        flex;
    flex-wrap:      wrap;
    gap:            var(--sp-2);
    padding:        var(--sp-2) 0;
    min-height:     40px;
}
